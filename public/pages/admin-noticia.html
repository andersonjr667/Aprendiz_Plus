<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin - Notícias</title>
  <link rel="stylesheet" href="/public/css/main.css">
  <script src="/public/js/auth.js" defer></script>
  <script src="/public/js/api.js" defer></script>
</head>
<body>
  <main class="container" style="padding-top:100px;">
    <h1>Gerenciar Notícias</h1>
    <div class="card" style="margin-bottom:16px;"><h3>Criar notícia</h3>
      <form id="newsForm"><div class="form-group"><label>Título</label><input name="title" class="form-control" required></div><div class="form-group"><label>Conteúdo</label><textarea name="content" class="form-control" required></textarea></div><button class="btn btn-primary">Criar</button></form>
    </div>
    <div id="list"></div>
  </main>

  <script>
    document.getElementById('newsForm').addEventListener('submit',async function(e){ e.preventDefault(); const f=new FormData(e.target); const payload=Object.fromEntries(f.entries()); const res=await fetch('/api/news',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); const d=await res.json(); if(res.ok){ alert('Criado'); load(); } else alert(d.error||'Erro'); });
    async function load(){ const res=await fetch('/api/news'); const d=await res.json(); const c=document.getElementById('list'); if(!res.ok){ c.innerHTML='Erro'; return;} c.innerHTML=''; d.forEach(n=>{ const div=document.createElement('div'); div.className='card'; div.style.marginBottom='8px'; div.innerHTML=`<h4>${n.title}</h4><p>${(n.content||'').slice(0,200)}</p><p><button data-id='${n.id}' class='btn btn-outline remove'>Remover</button></p>`; c.appendChild(div);} ); document.querySelectorAll('.remove').forEach(b=>b.addEventListener('click',async e=>{ if(!confirm('Remover?')) return; const id=e.target.dataset.id; const res=await fetch('/api/news/'+id,{method:'DELETE'}); if(res.ok) load(); else alert('Erro'); })); }
    load();
  </script>
</body>
</html>