<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Publicar Vaga - Aprendiz+</title>
  <link rel="stylesheet" href="/public/css/main.css">
  <script src="/public/js/auth.js" defer></script>
  <script src="/public/js/api.js" defer></script>
</head>
<body>
  <main class="container" style="padding-top:100px;">
    <section class="card" style="max-width:800px;margin:40px auto;">
      <h2>Publicar Vaga</h2>
      <form id="jobForm">
        <div id="step1">
          <div class="form-group"><label>Título</label><input name="title" class="form-control" required></div>
          <div class="form-group"><label>Localização</label><input name="location" class="form-control"></div>
          <button type="button" id="toStep2" class="btn btn-primary">Próximo</button>
        </div>
        <div id="step2" style="display:none;">
          <div class="form-group"><label>Requisitos</label><textarea name="requirements" class="form-control"></textarea></div>
          <div class="form-group"><label>Benefícios</label><textarea name="benefits" class="form-control"></textarea></div>
          <button type="button" id="toStep1" class="btn">Voltar</button>
          <button type="button" id="toStep3" class="btn btn-primary">Próximo</button>
        </div>
        <div id="step3" style="display:none;">
          <h4>Revisão</h4>
          <div id="review"></div>
          <button type="button" id="toStep2b" class="btn">Voltar</button>
          <button type="submit" class="btn btn-primary">Publicar</button>
        </div>
      </form>
    </section>
  </main>

  <script>
    const toStep2 = document.getElementById('toStep2'); const toStep1 = document.getElementById('toStep1'); const toStep3 = document.getElementById('toStep3'); const toStep2b = document.getElementById('toStep2b');
    toStep2.addEventListener('click',()=>{ document.getElementById('step1').style.display='none'; document.getElementById('step2').style.display='block';});
    toStep1.addEventListener('click',()=>{ document.getElementById('step2').style.display='none'; document.getElementById('step1').style.display='block';});
    toStep3.addEventListener('click',()=>{ document.getElementById('step2').style.display='none'; document.getElementById('step3').style.display='block'; const form=new FormData(document.getElementById('jobForm')); document.getElementById('review').innerHTML=`<p><strong>${form.get('title')}</strong></p><p>${form.get('requirements')}</p>`});
    toStep2b.addEventListener('click',()=>{ document.getElementById('step3').style.display='none'; document.getElementById('step2').style.display='block';});
    document.getElementById('jobForm').addEventListener('submit', async function(e){ e.preventDefault(); const form=new FormData(e.target); const payload = Object.fromEntries(form.entries()); const res=await fetch('/api/jobs',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); const data=await res.json(); if(res.ok){ alert('Vaga publicada'); location.href='/empresa/profile'; } else { alert(data.error||'Erro ao publicar'); } });
  </script>
</body>
</html>